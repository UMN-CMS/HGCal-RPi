#!/bin/bash
# IPBus setup
# the rdout/ and sync/ directories are copied to the pis,
# firmware is installed, and the IP/MAC address of the
# rdout CTL ORMs is set.

source etc/config

# copy and compile
./etc/copy_dirs


# setup IPBus
BOARDNUM=0
for RDOUT_PI_ALIAS in "${RDOUT_PI_ALIASES[@]}"
do
    echo "$RDOUT_PI_ALIAS ($BOARDNUM):"

    # set ip/mac addresses
    ssh $RDOUT_PI_ALIAS "cd $PI_RDOUTDIR; ./set_ipbus_ip $BOARDNUM"
    check_retval "$?"

    BOARDNUM=$((BOARDNUM+1))
done
