#!/bin/bash
# starts the executables on the raspberry pis


# get config
source etc/config


# sync boards
for SYNC_PI_ALIAS in "${SYNC_PI_ALIASES[@]}"
do
    echo "$SYNC_PI_ALIAS:"

    # stop any old executables
    ssh $SYNC_PI_ALIAS "sudo killall $SYNC_EXE"

    # copy directories over
    rsync "${RSYNC_FLAGS[@]}" sync/ $SYNC_PI_ALIAS:$PI_SYNCDIR

    # start pi executables
    ssh $SYNC_PI_ALIAS "cd $PI_SYNCDIR; ./run_sync"

    # make sure they are up
    ssh $SYNC_PI_ALIAS "pgrep $SYNC_EXE"
done


# rdout boards
for RDOUT_PI_ALIAS in "${RDOUT_PI_ALIASES[@]}"
do
    echo "$RDOUT_PI_ALIAS:"

    # stop any old executables
    ssh $RDOUT_PI_ALIAS "sudo killall $RDOUT_EXE"

    # copy directories over
    rsync "${RSYNC_FLAGS[@]}" rdout/ $RDOUT_PI_ALIAS:$PI_RDOUTDIR

    # start pi executables
    ssh $RDOUT_PI_ALIAS "cd $PI_RDOUTDIR; ./run_rdout"

    # make sure they are up
    ssh $RDOUT_PI_ALIAS "pgrep $RDOUT_EXE"
done
